# server 08 数据库

## 1.安装数据库

## 2.设置基本tcp/ip链接。

## 3.简单界面，创建数据库

![](images/1.png)

## 4.生成2个数据库文件，怎样移动和导入

一般复制不了，要提示权限，要想复制，先要右键，任务，分离



分离之后要导入，右键数据库，附加

![](images/3.png)

## 5.假设我不想要移动数据库文件，麻烦，右键，任务，生成脚本。

![1568013230174](images/4.png)

## 6.创建表，指定主键，标识规范，交由server维护。

![1568014380701](images/5.png)
=======
![1568014380701](images/5.png)

## 7.设置唯一健，不重复，

选择其中一列，右键，索引，唯一值

![1568039554609](images/6.png)

## 8.设置默认字符串。

![1568039659473](images/7.png)

## 9.设置检查

右键-check-约束-输入表达式，跟函数联系在一起



![1568040246446](images/8png)

## 10.关系，邮件，关系

![1568042320812](images/9.png)
## 11.设置能修改表，不然修改都会提示报错、

![1568078446153](images/11.png)

## 12设置外键链接主建，列名必须相同，通过下拉框选择

被决定的那张表是外键表，起决定的那张表是主键表

![1568079506310](images/12.png)

## 13.sql语言使用

1.利用master表查看数据库有没有你那张表

```
select * from sysdatabases
```

2.利用脚本文件创建,在这里最好主文件名叫_data,日志文件名叫_log

多个列间使用逗号分隔
	主键：primary key
	非空：not null
	惟一：unique
	默认：default()
	检查：check()
	外键：foreign key(列名) references 表名(列名)

```sql
create database test
on
(name='test_data',
filename='d:\test_data.mdf',
size=10mb,
filegrowth=10% )
log on
(name= 'test_log',
filename='d:\test_log.ldf',
size=3mb,
filegrowth=1mb)

使用test库
use test
创建班级表
create table classInfo
(
cid int not null primary key identity(1,1),
cname nvarchar(15) not null
)

创建学生表
create table stuInfo
(
sid int not null primary key identity(1,1),
sname nvarchar(10),
sgender bit default(0),
sbirthday date ,
sphone char(14),
semail varchar(20),
cid int not null,
foreign key (cid) references classInfo (cid)
)

主键加后面的增长策略， 外键与classInfo关联
增
insert into user2 (uname,paw) values('关羽','21232F297A57A5A743894A0E4A801FC3')
连续插入多个值，可以values后面加逗号隔开

insert  user2 (uname) values('张飞'),('赵云')

改
update user2 set uname='曹操' where uid=8


删
delete from user2 where uid=8

清空：truncate table 表名
清空表格的同时，把里面的规则也重置
```

常用辅助命令及快捷键
	set statistics time on/off：在消息栏显示详细执行时间
	ctrl+e执行
	ctrl+r隐藏消息栏
	ctrl+l计划任务，对sql语句进行分析

3.查询

top

```sql
select top 2 *
from user2

select top 10 percent*
from user2

-》排序：order by 列名1 asc|desc,列名1 asc|desc...
-》消除重复行：distinct

select * from user2 order by uid desc，cid asc

select distinct cid from user2
排除重复的



where 关键字，查找uid介于3跟8之间
select * from user2 where uid between 3 and 8

select * from user2 where int （1,3)

```

条件查询：写在where后面
	对行进行筛选，返回bool类型的值，如果某行中的列数据满足条件，则加入结果集，否则不出现在结果集中
	比较运算符：=，>，>=，<，<=，!=或<>
	between ... and ...表示在一个连续的范围内
	in表示在一个非连续的范围内
	逻辑运算符：and，or，not
	模糊查询：用于处理字符串类型的值，运算符包括：like % _ [] ^
		%与_写在[]中表示本身的含义
		在[]表示一个连续的范围可以使用-
		^写在[]内部的开头，表示不使用内部的任何字符
	null的判断：使用is null或is not null，与其它值计算时返回null，排序时null被认为是最小
	优先级：**小括号，not，比较运算符，逻辑运算符**

```
select * from user2 uname like '%张%'
%代表任意多个字符

select * from StudentInfo where sPhone like '1[^5]%'
选取手机号码第一个字符为1，第二个字符不是5的手机号码
```











5.分组

分组：group by 列名1,列名2...
	聚合函数一般结合分组使用，进行分组内的数据进行统计
	根据指定列进行分组
	分组后条件筛选：having ...

```sql
select gender,count(*) from sudent group  by gender
按照性别分组，统计人数
俗称按照某个列进行分组，在对行进行合并
多列也可以分组，分组的结果是是两个列的组合，在结果集中，分组依据值相同的在一列，在结果列中只能出现分组依据列和聚列
select cid,gender,count(*) from student group by cid,gender


查找学生编号大于2的各个班级，各个新别的人数
select cid,sGender,COUNT(*) as count from StudentInfo
where sid>2
group by cId,sGender 

统计学生编码大于2的各个班级，各个性别的人数，并且人数大于3

select cid,sGender,COUNT(*) as count1 from StudentInfo
where sid>2 
group by cId,sGender having COUNT(*)>3

```

6.联合查询

这种情况下列数和属性必须相同，union和union all的区别是，union会自动压缩多个结果集合中的重复结果，而union all则将所有的结果全部显示出来，不管是不是重复。

intersect(交集)

except(差集)集合运算：先将其中完全重复的数据行删除，再返回只在第一个集合中出现，在第二个集合中不出现的所有行。



## 100创建数据库，数据库基本操作

```sql
创建一个学生数据库，并制定三个文件存储，并归为一个文件组
create database student
on primary
(name='student1',
filename='g:\data\student1.mdf',
size=10mb,
filegrowth=10%),
(name='studnet2',
filename='g:\data\student2.ndf',
size=10mb,
filegrowth=10%),
filegroup filedb
(name='studnet3',
filename='g:\data\student3.ndf',
size=10mb,
filegrowth=10%)


查看数据库的基本信息
sp_help database

修改数据库
假设学生数据库由于增加太快，需增加一个文件存储数据
alter database 学生选课
add file 
(name='xsxk1',
filename='g:\data\xsxk1.ndf',
size=10mb,
filegrowth=10%)


数据库重命名
alter database 学生选课
modify name=xsxk


收缩数据库
右键-任务-收缩-文件
ALTER DATABASE database_name SET AUTO_SHRINK ON
alter database xsxk set auto_shrink on
```

![1568362798486](images/100.1.png)

![1568363033893](images/100.2.png)

```sql
使用 DBCC SHRINKDATABASE语句实现用户数据库收缩
DBCC SHRINKDATABASE语法格式如下：
DBCC SHRINKDATABASE(database_name,target_percent)
dbcc shrinkdatabase (xsxk,20)



```

